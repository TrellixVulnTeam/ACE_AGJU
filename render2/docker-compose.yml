version: "3.8"

x-environment:
  &environment
  REDIS_HOST: render.redis
  REDIS_PORT: 6379
  REDIS_DB: 0
  SLEEP: 5
  JOB_QUEUE_KEY: 'render:queue:incoming'

services:
  redis:
    container_name: render.redis
    image: redis:latest
    ports:
      - "127.0.0.1:6379:6379"
  render:
    container_name: render.renderer
    build: 
      context: src/shared
      dockerfile: ../renderer/Dockerfile
    environment: *environment
  controller:
    container_name: render.controller
    build:
      context: ./src/shared
      dockerfile: ../controller/Dockerfile
    environment:
      <<: *environment
      PORT: 8080
    expose: [8080]
  nginx:
    container_name: render.nginx
    build: src/nginx
    environment:
      NGINX_SERVER_NAME: "render.nginx"
      NGINX_X509_PRIVATE_KEY_B64: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRZ0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1N3d2dna29BZ0VBQW9JQ0FRRGdxR1NJa1A1UzdXeG8KbmkrOFVUNUFQZ2IxWFF1NFdvdmhpNXhFRElncnJja0F4VmtwSHlKbTQvdFQ5MTJoSHhrTGt0YUZsckpqeDJsYgpPZUlid0VnMXJDclZ2c0h5WUtvQUxzczNPSHJwWGFCMXpTaXV6dVd6Z2k1U1l1NUZiY2R6OGhmeXFqeG5VbFZmCkVYZXRLaVVybk5uZHJkbllmU2ZVYWJVbktZbVBFYWFmbFpqeDFkSDhkUXYzWDVHTTJNejB2RmFHOWxXVFhaRUwKNWxyYVdsdE1TWVRpcDlDaElvdzVibkgrMGNnRzdUbkRKeWlkY3l2c1MzM0VMQzBWK2xaOTRDZFZJWmFJd0RTRwpnTUo3Y3pCeVU0T3ZIeFRvTjlqOTVsODJSLzVQaENJZWgyMXYyaHYvOVRaclFnSFQ3Zks4emg0QS9BbUovTTZXCldUMStFSFZWZ2pyZXppWTRaRlEvUmtFaUNhV0lYWDlGU2xRRnpNS0Nld3BXUFVYYkI3MWUyOUtsdzJ3RVQ3UmEKenJtZjNidDYxNjVoWE9VL1ZuanBHYnV2d205Um83K3hvRnlUV3IvdGlxZ3V3T0JnbHliVk5ka1IxWW92aExObQpDRHI3M0lLbUt4dGxUK09GVEtLU1lJdzNTazN6VUpXOXcydXBwRUttMVJERTlmbSt5eml5UTd4eE82QjVGenJ0CnMzSG00T3dqc3JxczIyYzBBNmVadHpTQWJCRlA4U1RvVnEwaU9mUFdUV1RueVFKZmxZaUxzdGg2Tlhsam01VWQKblpQK0ZKS01RZ3c4RE1RTTRpNWhRWEJBZ3JhRTJ5TTJGYVcvMmNiSkJrYmY5M09BdmVmc1pXU1U5T1dxR3F5VgozcHQzazAvNGRLcVFuZDg0eG11NGsvVTNwYmtzS1FJREFRQUJBb0lDQUNGa1JoVWFZQUxaY1V5WGZvYmlHSHVaCi9KVEpzSzFGSUJkMUZkUHpmT1hwSGNBMGxRME1xS05jYllYTWRhazJJeFhhVEhKc3RMVXA5Wm51bjVINllZRkEKeHRrZ1VsbUJUcU5hVVRBeS8rbmgxYkRNdnFoRTdsVmhHeHQ1d3VxazU0bHZTV256TGFrNXpxQ2p5d0w5Q2F0UwowL3NrRlFZZGpDY0JVMEN2NXRkU0MwOGJBREdwMDExUDFHaC9WdlgxWDNsYzZRdUVYN0hZclc5MFhMcXB4WG93ClQwVVZKbWhjNXpTK0dzbUNTdFhrdXJvci90aHdQdTRQUm5FN0U3UjVraE9CbHJjTG1BRlplRFVwdkQ1M0g1Tk8Kb0hzT0JxQ0JkSXBBakpSWDNRL2FsdXVzdTNKdG04M09sN2tYaFlnSGpSWE5HUjZTVjZTZjQrRHJBTDNWR210RQo3L29ZdEVTbzM0ZGt2OE9kM0lwd1dZbE9zUUlONkVpSUx3bmdaaHBZMG9tZk5nM1ZBUS9uOHRzMFcrVjd3bUFKClRYU0R2N081ZjBOM093V0hJaFdUb2IycGg5dS9tMzlDQ1ZCSjdNNVcrNlVNbFhMK1ZYUWVqKzc3Z01qSHAxY0wKZi8rdmsxd2dYNS80bklsaTJzNHlIL2JvdzYzR1BvNUVFSmEyTVp3MXNUQi85TmFUbUlzTHRNbnNBdW5qb1JzTQprRVkyQnllMXlzaWZsaHJjUExyN3RFVGhUMytIS25RdVRWR2V1YzdtZVh6WkdsRVhNRmlvQjhMU2hHYlpKdzhTCldtcjRUc29xVThUQ2taQ3hUckZoOTBLMzR1OUJYQjVBTDZEMGswU09GTlkrdmljZVVxQ0NJd0pmS2tIS3N5OVcKTzcwcnZsL0h3dXk2cXU2UlhtUEZBb0lCQVFEMlhmcVk5SWdiZEFEVXB2VENhVTRqZnExRDQzY1AyTjAwbmdIWAp5bW50N08xMHRXTGVKVitUZ1FHVlRjZnhoT3JDdzhVV25WanMvMVpoNGhVUTBFYWl5RjlXR2FodEhUMGRwZVFTCkEzWnZkZXBLTUk0UUFRbDlBTGg1T1lyTUUyWUhOdXcrQUdMZDRSendTV3FwUjNtV2JoN2ZqalFhbkx5T0hFWWwKeXVwQ0RQQjRLdGN6YmY5QW13S2NZRlFlOHRhVVdCclBYVjc3dC9iN0RhUkwyMHVWUmNRQllpRWFRNCtLSEtPNQowbWtFTXI2dmErSmNoUXhaYVV0MkFBVFZ2ajBybXpGOXJ2cUtkS3JLbE1SemJSSGVnUUI5OTBRTlpsdmFKZzdjCm95aVZSOUVIZzZJSHRpS1lFdDNMWkZOVzVWcWNNQXhySUlrSmJFK1kwRmRxb01BSEFvSUJBUURwY1IwUHJwZFEKZDFNUkdISWt1WC9maTM4R3VIRWZNWW00ZmhnRXFpenVSU3VIY3JMWmlBR0JjWGpWbEE2WWRkb2ZjU3dhY0dMWQpndE1yOGZrSmtRc0M0RkZ4SktLUXVoVWVpODlYYzNHQmk0dXpIWTI4MmZNZnZrNVZFQmxOTVR4d1YzK2YvRkczCjlES1p2cWtDSjFNemwvRi9VM2l4Z2RnN2VXY1BxeWRKSkFhRDZ6UnJaMDg3R1p1TE5RNEdxL0I4N3pSTHdtaCsKUTlQNXA5d2tvd3k3SWVmZlZkelFEd0pWbVpTT1M3TDNaaXBMVXVLMU00WU44TVdwK2hCOVA1U3JCUVRxY0xNdApZNWExV0NDQVQxZ2NWbVhkd1VWQ0dyQVRNT1daS2xvc1Voam9TZDF4Vk9Ec1Z4eEhWdmYwUnRKRHVsNG9UQkFOCnFTdVpvQm1LaEVaUEFvSUJBRXN1TEkzR2VVNWZYTzJIc1VNdVhXRHBoRGdtVHF2d1VyaCt5ek10bXB1M1pGTHMKRXlxVkh4QmxHcldVRWNLNisrVEpWdmhxdGJ0RXcvaUV4RWJvTjlYdTdXRFozWkxHakdMaXY3RmJpeVhDUnVleQozM2MweWM5eWk5aTZYWWVmRjlCMXl5dTBkSGNlL2ZTNWdxbjduTGZ5RE12Tm1rclFyNTF5TlZuTkRTVnd5MlR3Ck5kR0U3SktyZXVWN1k5QTU3STlDUDVRdCt4RTNkMC92UHNiRE9kSm9nc0tsVGxLMGNUWUZQVlUwUjBXM3NvYlgKbGpFRGpOd3dESTRLdlc3NGFiUkgzSmRzOFJtVk5wVXhScTJ1aC9odFIxZ3BQNFFUUzA1THROZFJsczNQSjVOeQpjTnlIa1JEMUdPZTdTczlHbUJyM2NxS3lQLzgzSlNjTjFNOCtGTHNDZ2dFQkFOYjJWem1DbjBuMHAyUmRxM1pQCjd3V3VFZW5oWENIS1h6U3B3SHBETHA2MnlVK3YraXZBUndxb3NBbVVqaUFzbmhCSUNjSEs3ZXJNQmFNNDdnZTIKTFhxWGo4ZHRZZGw5MFViUW5ieTh6Sy9yRFZpQ0JXdjdFeHVQQmRqa3V6Zk8rQVhIUFBuWXduTnZoa3ozT2ZDRwp2K0lKcjlOOHpPNUFVQnJzUDFBNVhqTEczczBKZ0xyS1pqWlk3VmV5SWxsWWFWclNkc2l3bThKeHVUZnpNQS80CnFSZUZNRjBEVnhPc1RveitvTUtyeUlCeTdzMXY1TjNSTlVlUENLWHVaTkxCQXFpOU5YcWhEdzNqMy9yYnpRbjYKaG51SnY4SUZZRDV3RHVXTktFL3pwUmVjL2R5aGNDNFZhQTJhWmFyMzFkcDJnTmJuUGg5RGM2RHd2L3AyYUM2YQpnWmNDZ2dFQUlLVkVvcExsRUQ4Z2RpdUNHK0Njb0tLS2YreW5HNlZXTWN0MEJ1elArNEQwOW5iOTJKSExPbHJ0CkhNemRwSm9pR1lFUkEwSkVuekR3OUlMKzN1RGdjMVVhWjA0aEozSUxVYzl4TXRSek12TnFVR2dhd0d1MkJaQWMKUVBCSmxZanRGckFlRllGRUwrZVQwUy9MTTk2OXlzODZ3dkk0b0wzblhXeE0ydm5qTi9VNUphYlJxYUtSSEhHMQpUR0RVaWdIMjJ2TkRrZUJmYlNReE5lSTJZTUdqeUk3NnJ1WDJ5ZzRSZEx2aHhsRVliZXRBSE5wTURoTDlHZXh4CjZtWE1IRGVpSHcwYkJ4eDVBdEFxR2l4elhHTzhKL2dxL3lYdll4b1YzY0hObjYwRjBJZ2RzNGgrZWg0QzNOWDgKbS96RnNZTWxPYUZRT0FVaFB0RXgyTjZtWTVidWJ3PT0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo="
      NGINX_X509_PUBLIC_CERT_B64: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZURENDQXpRQ0NRQ1NYN1loNjR2QnZqQU5CZ2txaGtpRzl3MEJBUXNGQURCb01Rc3dDUVlEVlFRR0V3SlYKVXpFTk1Bc0dBMVVFQ0F3RVQyaHBiekVUTUJFR0ExVUVCd3dLUTJsdVkybHVibUYwYVRFVk1CTUdBMVVFQ2d3TQpWR2h5WldGMElFbHVkR1ZzTVI0d0hBWURWUVFMREJWRmVIUmxjbTVoYkNCVWFISmxZWFFnVTNGMVlXUXdIaGNOCk1qQXdOekUzTWpBek9EUTNXaGNOTWpFd056RTNNakF6T0RRM1dqQm9NUXN3Q1FZRFZRUUdFd0pWVXpFTk1Bc0cKQTFVRUNBd0VUMmhwYnpFVE1CRUdBMVVFQnd3S1EybHVZMmx1Ym1GMGFURVZNQk1HQTFVRUNnd01WR2h5WldGMApJRWx1ZEdWc01SNHdIQVlEVlFRTERCVkZlSFJsY201aGJDQlVhSEpsWVhRZ1UzRjFZV1F3Z2dJaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUURncUdTSWtQNVM3V3hvbmkrOFVUNUFQZ2IxWFF1NFdvdmgKaTV4RURJZ3JyY2tBeFZrcEh5Sm00L3RUOTEyaEh4a0xrdGFGbHJKangybGJPZUlid0VnMXJDclZ2c0h5WUtvQQpMc3MzT0hycFhhQjF6U2l1enVXemdpNVNZdTVGYmNkejhoZnlxanhuVWxWZkVYZXRLaVVybk5uZHJkbllmU2ZVCmFiVW5LWW1QRWFhZmxaangxZEg4ZFF2M1g1R00yTXowdkZhRzlsV1RYWkVMNWxyYVdsdE1TWVRpcDlDaElvdzUKYm5IKzBjZ0c3VG5ESnlpZGN5dnNTMzNFTEMwVitsWjk0Q2RWSVphSXdEU0dnTUo3Y3pCeVU0T3ZIeFRvTjlqOQo1bDgyUi81UGhDSWVoMjF2Mmh2LzlUWnJRZ0hUN2ZLOHpoNEEvQW1KL002V1dUMStFSFZWZ2pyZXppWTRaRlEvClJrRWlDYVdJWFg5RlNsUUZ6TUtDZXdwV1BVWGJCNzFlMjlLbHcyd0VUN1JhenJtZjNidDYxNjVoWE9VL1ZuanAKR2J1dndtOVJvNyt4b0Z5VFdyL3RpcWd1d09CZ2x5YlZOZGtSMVlvdmhMTm1DRHI3M0lLbUt4dGxUK09GVEtLUwpZSXczU2szelVKVzl3MnVwcEVLbTFSREU5Zm0reXppeVE3eHhPNkI1RnpydHMzSG00T3dqc3JxczIyYzBBNmVaCnR6U0FiQkZQOFNUb1ZxMGlPZlBXVFdUbnlRSmZsWWlMc3RoNk5YbGptNVVkblpQK0ZKS01RZ3c4RE1RTTRpNWgKUVhCQWdyYUUyeU0yRmFXLzJjYkpCa2JmOTNPQXZlZnNaV1NVOU9XcUdxeVYzcHQzazAvNGRLcVFuZDg0eG11NAprL1UzcGJrc0tRSURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFBZU9oblRrUkpQYkFSR2hVNEZZckRYCkYyZnNLRkVPR1JON1lCWDZML2Mwald0L1V6eTNrc3ZNbHhjR3h4c1pRY2RFQVc2SVZDQWFXZHd2bUtvbzhLNzAKZVRNdkNodmg3ZVpqZGRoQ3pOKy9zVGJmK0g0VEdjYzFaTXFPcnJZdzlzajRpemEvdmlFbEV3SzdGT200Ymt5awpnYzllL2xoTEpZbUgrSURhenQ2VUtjdnN6U2dOMzRVMkx3akNpcGZvQ1VUVER2UGJkQlVCNmUwU1hMQnRaYTJXClhwd0syRTQ5VFB4a1V6Z0Y1N1VjOGFGZWFZdFVZTmhaNW9LL0h4T1FQamg2WVlUT2k0UmdVd3BPOHpYMWIreEEKVVFjVlpGU3RJYVNtZGplNXpCaFJ2RGdkK25OV2dhcDF5MFBNeWlONU9ENnlOb1A1SHhKbzlUdjZrODhuckQvNgpLbHJwY0d6VzBxalJ5bDZiSTloazZhQXhXclNNNzdjNUN2VFdYNjhQckVoMVJEU0psOTRPaWZJS1Z5UUxlc3RpCkRLTEo0SkNWd2V3OHB0eHk0V0l0a3pVUnBpOU1uaThxSVZ5YkVwZnVnazVqdkpNRGE5Uk1hZ2QzZ2hXWmdUaC8KUElRT01HL3ovTjNWTmhlRTM2OW13YWxCaFFUZjJHUG4yTkl2LzZldkMrenBvZnZhQ1dRdnJMcjE2c1U4bDUyaQo0UEo2TjdyS3M4YStIekpXT1pNOHVpdXdZWFRINWNnOTVrLzRMOGFoTERaWW9WVHk4N09VUFQ4ZHJTd0tGaFVWCjFWbXAwcGtSNW83Q1FDdjg0R1kyQXYxbVZIM1Y0SzNOeG5NZ1VlME1RRHRRTEwxTGhiN2lGMFpiT28reG1Id0kKZWl3RjlYUmFQdVRac3dHT0Y5TjdUQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
      CLIENT_CERT_CA: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZVakNDQXpvQ0NRRGl5RGd4aWZsS3B6QU5CZ2txaGtpRzl3MEJBUXNGQURCck1Rc3dDUVlEVlFRR0V3SlYKVXpFTk1Bc0dBMVVFQ0F3RVQyaHBiekVUTUJFR0ExVUVCd3dLUTJsdVkybHVibUYwYVRFVk1CTUdBMVVFQ2d3TQpWR2h5WldGMElFbHVkR1ZzTVNFd0h3WURWUVFMREJoRmVIUmxjbTVoYkNCVWFISmxZWFFnVTNGMVlXUWdRMEV3CkhoY05NakF3TnpFM01qQXpPRFE1V2hjTk1qRXdOekUzTWpBek9EUTVXakJyTVFzd0NRWURWUVFHRXdKVlV6RU4KTUFzR0ExVUVDQXdFVDJocGJ6RVRNQkVHQTFVRUJ3d0tRMmx1WTJsdWJtRjBhVEVWTUJNR0ExVUVDZ3dNVkdoeQpaV0YwSUVsdWRHVnNNU0V3SHdZRFZRUUxEQmhGZUhSbGNtNWhiQ0JVYUhKbFlYUWdVM0YxWVdRZ1EwRXdnZ0lpCk1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRQ2JTSDdSdHE3MlFxYUtzWUtTVzdXbW82OU8KVmZoK0lhT1VGWksvRjVHZTRDcWdaSXlSVlZVZ2hETVZudVJDWVFwcWRtODJNKzhnSzk3amxFUVVNbzYzTGk2cwo2N04ra2drczNINnVWQlJocEZpZ3RRbm9FN1Vad05nR2F5eDVva3k0UEVyRUFjZjBDNXBNTTlQT3c2cWtqRkNVClpVNFJaY21QOHF4NWJsVmU5SFFZcFVlZ3hZSVl3Vk5tZWF2RFFRS1VHQUtwdVljTWN6c09zU2Y5aW1HQmZoOFoKamRwYW5VVHJSeXpSbnZGQnZaMGFjbmh6YzVtcVNhRHduVTlBblovWWNqcXVQUzVLRnlDQjJXVXV3RFU2eHNkMgp3MjFidG03WVlOL0ZraU5wR1FIelpTUEJoYU9Sd2IwYnBmSTJsejlZMER5VWh6M2hZRUQ5NFN0SmcwQU1GbVlECnBvM2xhVVJWQkdQYkdnZGs0RE1hNzBLYU5QSURZaTRWNUFVN2JBdVRIUTlVNVB3blhibEFxVE9pdUYrZk8va0wKUHJ2cURxdE9OR2t4L2VRY1BhbTZWb1JhSkVFYWhGQ2xWMGRzZGRiWmdzOVloV0l3NHhCS1JXUkQ1UTM2b2JQZgpjaTJqRDUxSDQ2cEFiTGlZWG5sMHdEVmw0Vm5wY3FTWVR2RjNYMkpVS1owKzVHSEV6VXdPc204dlkrWmpRbHFtCmdaOC9DV2pKL1JOY05WemlwUjhOcmpEZGMrY1hPWnhBUnRBOFJFWlp2MnE5QzFWWGc2TmUrTnY1ZHEyclVlSE0KRUpCWW9oN1RUZTh2a3NnNDZqaGxOR2NZRVpMRG1RcDBYVjN1NjBHbnFwQThEbWFJWWlNZSs4R3V4dHRFTU91QgpNcFJYci83M1JDMXd5aTBRaHdJREFRQUJNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJsb3A5UnpzeWl0YVBSCkpPWVQraHpBK0ZXb1M2eWZoRmozZ2RkSm5vc1lvNTBrRi9kUnp4aHJ1VXhRUmEzZlpoOXFMcG1UV0NaY2hnaWsKSWJicGFqdVgybkM3bDg5R3duajBDUHNEakxGbUJ2N21rNzRkWEMyeTdlL0IwVFFHOGpuRkhTd2NhLzFkb3JlaQpQT2llNVUzd0VYd3d6OVBIemJaOTdoNGlwdGtjc3ptOTQrOWx1RFVHTVd0V29MK2k1Zkk0aGZvWmNaa2tWQ1dBCmRMd0pZV1JOK1phVFNCMzN4ZUthcjliUFRSUGNtUWI0QnljMGU5UWRDb3dFelk1N2d0RHd0ZWNDWllkUjIwanoKcDdMMG1iRGptZHF4b1JKQ1grUkk1WXo1ZmRMMjY1Nmt5R2NEa2ZqUkhVWWFpbHB2NXNWakJVZHZ2K1ZvRGh5SwpKL05heUdxbENiNW1oWVZqc3ZpVGlDOFdzWWZOcHdxYkxESGgvcXlMWS9TTUkxWFdHcDV1Tm5UemxaeVE1NkQrCmZ3SHhQTHc2NEJkdURMV3p1dktJbm5VaXlVQzQ0bmNGMUlUUHU4UFZuczF3K3ppR0VpeG5xNzl6MlY4RUtIVDYKdWxrOVlpbFpVc29PZzVVM1pqSTZZUy9OWkU1YXI3TkFjTFRaOXVzVlpqRGdwL1lKTmFEVHdxcUxSVmdOUlZ5dAp0RDRlMlpWT01ZY1lkNitkaHJjayt2Y0w1Y2dSODRCODgzY1l4b1lNOXVXS2FjblNsd2s4R0JMY0cxNGhtOUJYCkhiM0F0SW94MFhIeXNJa2pOdDB1eG9wOFNoUUZpZlZOOSt2ZlhNWi9SODVKWHdiS090cHRBK0hPdVpXdTYxWEsKMHgyeHQ4cFdzYWtJSE1kVDFHSmlRaDI0cjFPeHV3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
      UVICORN_HOST: "render.controller"
      UVICORN_PORT: "8080"
    ports:
      - "127.0.0.1:8443:8443"
